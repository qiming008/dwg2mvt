# 后端服务启动指南 (Windows)

本文档详细介绍了在 Windows 环境下启动后端服务的多种方式。

## 方式一：一键启动脚本（最推荐）

我们提供了一个批处理文件 `start.bat`，它会自动处理环境配置、依赖检查和服务启动。

**步骤：**
1.  进入 `backend` 目录。
2.  双击运行 `start.bat`。

**脚本功能：**
*   自动检测 `tools` 目录下的 LibreDWG 和 GDAL。
*   自动创建或激活 Python 虚拟环境 (`.venv`)。
*   自动安装 `requirements.txt` 中的依赖。
*   启动 Uvicorn 服务（默认端口 8000）。

---

## 方式二：PowerShell 分步脚本

如果您需要更细粒度的控制，可以使用 PowerShell 脚本。

### 1. 首次配置 (Setup)
以管理员身份打开 PowerShell，运行：
```powershell
cd backend
.\setup.ps1
```
*   此脚本仅负责创建虚拟环境和安装依赖。
*   如果遇到权限错误，请先运行：`Set-ExecutionPolicy RemoteSigned -Scope CurrentUser`。

### 2. 启动服务 (Run)
```powershell
.\run.ps1
```

---

## 方式三：手动命令行启动

适用于开发调试或脚本无法正常工作的情况。

```powershell
# 1. 进入后端目录
cd backend

# 2. 创建虚拟环境 (仅首次)
python -m venv .venv

# 3. 激活虚拟环境
.\.venv\Scripts\Activate.ps1

# 4. 安装/更新依赖
pip install -r requirements.txt

# 5. 启动服务
# --reload: 代码变更自动重启
# --host 0.0.0.0: 允许局域网访问
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## 服务验证

启动成功后，您应该能看到如下输出：
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

您可以访问以下地址进行验证：
*   **API 文档 (Swagger UI)**: http://localhost:8000/docs
*   **健康检查**: http://localhost:8000/

## 常见问题排查

### 1. 端口被占用
错误信息：`[Errno 10048] error while attempting to bind on address ('0.0.0.0', 8000)`
**解决方法**：
修改启动命令端口，例如：
```powershell
uvicorn app.main:app --reload --port 8001
```
或者在 `start.bat` 中修改相关行。

### 2. 找不到 Python
确保您已安装 Python 3.11+ 并在安装时勾选了 "Add Python to PATH"。

### 3. 脚本无法执行
PowerShell 默认禁止运行脚本。请执行：
```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```
并输入 `Y` 确认。
